#五子棋实验报告

该五子棋游戏有人机对战，双人对战和AI对下三种游戏模式。在人机对战模式中，游戏开始前可以自行选择何方先手并且设置禁手（三三，四四，长连或无禁手）。此游戏具有悔棋功能，且可以一直回退到玩家最早落子状态。此外，游戏还存在AI代下功能，可以让AI代替玩家决定当前回合下子位置。

这个五子棋游戏使用了EasyX库来制作UI，未使用任何外部图片，棋盘，棋子，按键均为直接通过程序绘制。程序主要分为以下模块：UI绘制，按键交互，判断当前棋局（是否存在获胜或禁手违规），AI落子，棋局记录。

UI绘制使用了EasyX自带的库，通过程序绘制背景，线条，图形，文字等内容形成整体UI界面。UI自始至终贯穿整个游戏流程，从开始界面的标题和游戏模式选择绘制，到先手和禁手选择中通过改变文字颜色确定选择模式，再到游戏进行时对于棋子和编号的绘制，每一次交互与游戏流程的进行都伴随着显示的变化。

按键交互主要体现在游戏开始时模式的选择和游戏进行中落子和代下、悔棋、退出等操作。使用程序绘制按钮，并且判定若存在按钮范围内存在鼠标左键点击时则执行相应程序。按键交互保证了游戏的进行，同时维持游戏规则。关键代码为通过识别鼠标点击位置，例如在棋盘落子点识别半径范围内点击，则会触发落子程序，在判定该点可以落子后执行相应操作，游戏流程得以正常进行。

棋局判断主要为检测当前棋局是否结束或者是否存在违规现象。通过依次扫描程序每一个棋子并且从该棋子向周围所有方向拓展，根据四个方向探测到的棋子情况来判断是否有一方胜利或者存在禁手违规。在胜利判断上只需要在新落子位置进行检测是否连成五子即可。存在变量记录步数，在提供棋子显示回合数的同时根据是否超过最大落子数量判断是否平局。禁手判断则是根据禁手的选择进行相应的判断，如长连需要检测是否有棋子相连数量超过5，三三禁手需要检测是否存在两个及以上活三，四四禁手需要检测一个位置是否存在两个及以上四连，上面两种禁手检测功能的实现通过以该点为中心，向两个方向拓展，直到碰到边界或者碰到另一方棋子或者两个方向碰到总共超过一个空位结束，若符合上述禁手条件则计数加一，四个方向依次检测，同时对于其他不符合上述检测条件的禁手状况进行打表检测，若计数大于等于一则判定存在禁手违规。该判定模块决定游戏的结束和违规，在每一回合落子后都会执行检测。

AI落子即为AI回合，通过该模块实现机器对于落子位置的选择。主要使用了估值算法和博弈树，以及使用α-β剪枝算法大幅度降低时间复杂度。AI对棋局的判断为在层数递归中不断进行AI和AI模拟的玩家依次在每个空位交替落子，通过对于当前落子后棋局的估值进行分数的累加，并在最后一层比较选择最高分并记录最高分获得时AI最初落子位置。每次递归同时会进行α-β剪枝比较当前分数和该层分数的α值或β值，去除大部分无效路径。估值算法的实现是通过根据当前模拟落子位置进行判定，通过该位置的各个方向连子以及是否有对方落子阻挡进行相应的估值。同时存在假设己方落子和对方落子，分别作为进攻分数和防御分数。AI的基础设定思路是防御为主，进攻为次要选择，在两者中根据估值选择最优方案。此外还可以手动调整AI的进攻分数和防御分数占比，从而改变AI的落子逻辑，决定攻击为主或防御为主。如在机器对下中调高后手方的攻击占比可以提高其胜率。

棋局记录负责记录当前棋局以及各个回合落子位置，实现悔棋功能。设置棋盘数组和步骤数组等全局变量从而实现全局的记录。每次落子棋盘数组上的数值会变化，同时步骤数量增加，数组的当前步骤数量位置会存储该步落子位置。当进行悔棋操作时，只需要步骤数量回退，棋盘数组相应位置改为空，通过绘图进行棋子的清空和重新绘制棋盘线便可以实现。同时悔棋还会根据不同的对局模式回退不同步数，在人机对战一次退两步，双人对战一次退一步，并且设置悔棋上限，只能回退到玩家第一手，从而避免步骤回退过多的问题。

该程序运行速度快，AI算法优化较好，在六层深度对弈的情况下察觉不出AI算法运行时间。UI与交互功能简单清晰，新落子字体标红表示与棋子上显示回合数有助于分析理解棋局。程序总体大小适当，AI算法利用率高，但在UI上存在较多重复。在合理的攻击值和防御值得设定下AI的智能水平较高，可以在后手情况下跟网上大部分AI打平，机器互相对战也多为平局，进攻能力较弱，防御能力强，总体中规中矩，在和人对弈中难以出奇制胜但可以防住大部分进攻和套路阵型。

参考文献：
α-β剪枝算法 https://oi-wiki.org/search/alpha-beta/
EasyX库基础用法教程 https://blog.csdn.net/qq_61797201/article/details/122827689?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522166729927316782427444797%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=166729927316782427444797&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2\~all\~top_positive~default-1-122827689-null-null.142\^v62\^pc_search_tree,201\^v3\^control_1,213\^v1^control&utm_term=easyx%E5%9B%BE%E5%BD%A2%E5%BA%93%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B&spm=1018.2226.3001.4187